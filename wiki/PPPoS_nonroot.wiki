#summary 非root多用户PPP over SSH 服务器端配置


一般linux服务器端的pppd只允许root用户执行，普通用户要通过配置sudo才能执行，通过特殊的ssh配置，还能限制用户只允许执行pppd命令，同时不允许用户使用ssh登陆到shell。此方法必须使用公钥验证。



= 配置 =
1) 新建用户，修改密码（密码不要分发给用户）
{{{
useradd sshvpn1 -m
passwd sshvpn1
}}}
2) 为用户生成密钥对
{{{
ssh-keygen -f id_rsa_sshvpn1 -N ""
}}}
3) 配置用户密钥验证
{{{
mkdir ~sshvpn1/.ssh
echo -n 'command="/usr/bin/sshcheck.sh",no-pty,no-agent-forwarding,no-port-forwarding,no-user-rc,no-X11-forwarding ' >>~sshvpn1/.ssh/authorized_keys  #注意最后的单引前面有空格
cat id_rsa_sshvpn1.pub >>~sshvpn1/.ssh/authorized_keys
}}}
4) 下载sshcheck.sh脚本到/usr/bin/sshcheck.sh
{{{
wget -O /usr/bin/sshcheck.sh http://autovpn-for-openwrt.googlecode.com/svn/trunk/script/sshcheck.sh
chmod +x /usr/bin/sshcheck.sh
}}}
5) 授权用户可以执行pppd
{{{
echo "sshvpn1 ALL = (root) /usr/sbin/pppd, NOPASSWD:/usr/sbin/pppd" >>/etc/sudoers
}}}

6) 把私钥文件:id_rsa_sshvpn1 分发给用户，ssh连接的时候使用此密钥验证。
